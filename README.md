<br>COMP9311   25T1: Project   1<br>Deadline: Friday 20:59:59 April 4th      (Sydney Time)<br>Aims<br>This project aims to   give you   practice   in<br>•             Reading and understanding a moderately   large   relational   schema   (MyMyUNSW).<br>•             Implementing   SQL   queries   and views to   satisfy requests   for information.<br>•             Implementing   PL/pgSQL functions to aid   in   satisfying   requests for   information.<br>•             The goal is to build some useful data access operations on    the MyMyUNSW   database.   The   data   may   contain   some   data   inconsistencies;   however,   they   won’t   affect your answers to the   project.<br>Background<br>All   Universities   require   a   significant   information   infrastructure   to   manage   their   affairs.   This   typically   involves   a   large   commercial   DBMS   installation.   UNSW’s   student   informat-ion system sits behind the MyUNSW web site. MyUNSW provides an interface to a   PeopleSoft enterprise management system with an underlying Oracle database.    This   back-end   system   (Peoplesoft /Oracle) is   often   called   NSS.UNSW has spent a considerable amount of money ($80M+) on the   MyUNSW/NSS   system,   and   it handles   much   of the   educational   administration   plausibly well.   Most   people gripe   about   the   quality   of the   MyUNSW   interface,   but   the   system   does   allow   you   to   carry   out   most basic   enrolment tasks online.<br>Despite its   successes, MyUNSW/NSS   still has   several   deficiencies, including:<br>•             No waiting lists for   course   or   class   enrolment.<br>•             No   representation for degree program structures.<br>•             Poor integration with the UNSW   Online   Handbook.The   first   point   is   inconvenient,   since   it   means   that   enrolment   into   a   full   course   or   class   becomes   a   sequence of trial-and-error attempts, hoping that   somebody has   dropped   out   just before you   attempt to   enroll and that no-one else   has   grabbed   the   available   spot.<br>The second point prevents MyUNSW/NSS   from being used for three important   operations that would be extremely helpful to   students   in   managing   their   enrolment:<br>•             Finding out   how far they have progressed through   their degree program, and what   remains to be   completed.<br>•             Checking   what   are   their enrolment   options   for   next   semester    (e.g.,   get   a   list   of   available   courses).<br>•             Determining when they have completed all the requirements of their degree   program and   are   eligible to graduate.NSS   contains   data   about   students,   courses,   classes,   pre-requisites,   quotas,   etc.   but   does   not contain any representation of UNSW's    degree program structures. Without    such   information in the NSS database, it is not possible to do any of   the above three. So, in 2007   the   COMP9311   class   devised   a   data   model   that   could   represent   program   requirements   and rules for UNSW degrees. This was built on top ofan existing schema that represented   all the core NSS data   (students, staff, courses, classes, etc.).   The   enhanced   data   model   was   named the   MyMyUNSW   schema.The   MyMyUNSW   database   includes   information   that   encompasses   the   functionality   of   NSS, the UNSW Online Handbook,   and the CATS    (room allocation) database. The   MyMyUNSW   data model,   schema and database are   described   in   a   separate   document.<br>How to   do this   project:<br>•             Read this   specification   carefully and   completely.<br>•             Familiarize with the database   schema   (description,   SQL schema,   summary).<br>•             Make   a private directory for this   project   and   put   a   copy   of the   proj1.sql   template   there.<br>•           You   must   use   the   create   statements   in   proj1.sql   when   defining   your   solutions.<br>•             Look at the expected outputs in the qX_expected tables loaded   as part of   the check.sql   file.<br>•             Solve   each   of   the   problems in   ‘tasks’   section   and   put   your   completed   solutions   into proj1.sql.<br>•             Check   that your   solution   is   correct   by   verifying   against   the   example   outputs   and   by using the   check_qX() functions   (following the ‘AutoTest   Checking’ section).<br>•             Test that your proj1.sql   file will load   without error into a database containing just   the original   MyMyUNSW   data.<br>•             Double-check that your proj1.sql   file loads in a single pass into   a database   containing just the original   MyMyUNSW   data.<br>•             Submit the project via moodle.<br>•             For each question, you must output result within   120   seconds   on vxdb01   server.<br>•             Hardcode is strictly   forbidden.<br><br><br>Setting   Up<br>To   install the   MyMyUNSW   database   under your vxdb01   server,   simply run the   following   two   commands:<br>$ createdb proj1<br>$ psql proj1 -f /home/cs9311/web/25T1/proj/proj1/mymyunsw.dump<br>If   you've   already set   up PLpgSQL in your   template1   database,   you   will get one error   message as the database   starts   to   load:<br>psql:mymyunsw.dump:NN:   ERROR:    language   "plpgsql" already   exist.You   can   ignore the   above   error   message,   but   all   other   occurrences   of ERROR during   the   load need to be investigated. If   everything proceeds correctly, the load output should look   something like:SETSETSETSETSETpsql:mymyunsw.dump:NN: ERROR: language "plpgsql" already exists                                                    ... if PLpgSQL is not already defined, the above ERROR will be<br>replaced by CREATE LANGUAGE<br>SET<br>SET<br>SET<br>CREATE TABLE<br>CREATE TABLE<br>                                                      ... a whole bunch of these<br>CREATE TABLE<br>ALTER TABLE<br>ALTER TABLE<br>                                                      ... a whole bunch of these<br>ALTER TABLE<br>Apart from possible messages   relating to   plpgsql, you should   get   no   error   messages.<br><br><br><br><br>The database loading should take less than   60 seconds on   vxdb01, assuming   that vxdb01   is   not under heavy load.<br>Note:<br>•          If   you leave your project until the last minute, loading the database on vxdb01 will   be considerably slower, thus delaying your   work   even   more.<br>o   The   solution:   at   least   load   the   database   Right   Now,   even   if you   don't   start   using   it for a while.<br>•          Note   that   the   mymyunsw.dump   file   is   50MB   in   size;   copying   it   under   your   home   directory   or your ‘/localstorage’   directory is not a good idea.<br>•          If you   have   other   large   databases   under   your   PostgreSQL   server   on   vxdb01   or   if   you   have   large   files   under   your ‘/localstorage/YOU/’   directory,   it   is   possible   that   you will exhaust your vxdb01 disk quota. Regardless,   it   is   certain that you   will   not   be able to store two copies of   the MyMyUNSW database under   your vxdb01 server.<br>o   The       solution:          remove       any          existing          databases       before          loading       your   MyMyUNSW   database.<br>Summary on Getting   Started<br>To    set    up    your    database    for    this      project,      run      the      following      commands      in      the      order   supplied:<br><br><br>$ createdb proj1<br>$ psql proj1 -f /home/cs9311/web/25T1/proj/proj1/mymyunsw.dump<br>$ psql proj1<br>                                                      ... run some checks to make sure the database is ok<br>$ mkdir Project1Directory<br>                                                      ... make a working directory for Project 1<br>$ cp /home/cs9311/web/25T1/proj/proj1/proj1.sql Project1Directory<br><br><br>The   only   error   messages   produced   by   these   commands   should   be   those   noted   above.   If   you omit any   of the steps, then things will   not work   as   planned.<br><br><br><br><br>Important Advice   Before You StartThe   database   instance   you   are   given   is   not   a   small   one.   The   first   thing   you   should   do   is   get   a   feeling   for   what   data   is   there   in   the   database.   This   will   help   you   understand   the   schema better and will make the tasks   easier   to   understand.<br>Tip: study the schema of each table   to see   how tables   are   related and   try write some   queries   to explore/ understand what each   table is storing.<br>$ psql proj1<br>proj1= \d<br>                                                      ... study the schema ...<br>proj1= select * from Students;<br>                                                      ... look at the data in the Students table ...<br>proj1= select p.unswid from People p join Students s on (p.id=s.id);<br>                                                      ... look at the UNSW ids of all students ...<br>proj1= select p.unswid, s.phone from People p join Staff s on (p.id=s.id);<br>                                                      ... look at the staff ids, and phone s of all staff ...<br>proj1= select count(*) from Course_Enrolments;<br>                                                      ... get an idea of the number of records each table has...<br>proj1= select * from dbpop();<br>                                                      ... how many records in all tables ...<br>proj1= …<br>                                                      ... etc. etc. etc.<br>proj1= \q<br><br><br>Read these before you start   on the   exercises:<br>•             The marks   reflect the relative difficulty/length   of each   question.<br>•          Work   on   the   project   on   the   supplied   proj1.sql   template   file.<br>•             Make   sure   that   your   queries   work   on   any   instance   of   the   MyMyUNSW   schema;   don't   customize them    to    work    just    on      this      database;      we      may      test      them      on      a   different database instance.<br>•             Do   not assume that any   query will return   just   a   single   resu<   even   if it   phrased   as   "most"    or    "biggest",    there    may    be    two    or    more    equally    "big"      instances      in    the   database.<br>•          When       queries       ask       for       people's      names,      use      the   Person.name field;       it's      there   precisely to   produce displayable names.<br>•          When   queries   ask for   student   ID,   use the   People.unswid   field; the   People.id   field is   an   internal numeric key and   of no   interest to   anyone outside the   database.<br>•             Unless    specifically    mentioned    in    the    exercise,    the    order    of    tuples    in    the   result does not matter;   it can always   be   adjusted   using   order   by.   In   fact,   our   check.sql will   order your   results automatically for comparison.<br>•             The    precise    formatting    of    fields    within    a    result    tuple   does   matter,      e.g.,      if    you   convert a number to   a string using   to_char   it   may no   longer   match   a   numeric   field   containing the same value,   even though the two fields   may   look   similar.<br>•          We   advise   developing   queries   in   stages;   make   sure   that   any   sub-queries   or   sub-   joins that you're using works correctly before using them in the query for the final   view/function<br>•          You      may      define      as      many      additional    views      as    you      need,      provided    that      (a)    the   definitions    in proj1.sql   are    preserved,    (b)    you    follow    the    requirements    in    each   question   on what you   are   allowed to   define.<br>•             If    you    meet    with      error      saying      something      like      “cannot      change      name      of    view   column”,   you   can   drop   the view   you   just   created   by   using   command   “   drop view   VIEWNAME cascade;” then   create your new view   again.Each question is presented with a brief description of   what's   required.   If   you want the full   details   of   the   expected   output,   look   at   the   qX_expected tables    supplied   in   the   checking   script   (check.sql).<br>Tasks<br>To facilitate the semi-auto marking, please pack all your SQL solutions into view/function   as   defined   in   each problem   (see details   from the solution template we   provided).<br>Question   1   (3 marks)Define a SQL view Q1   (subject_code)   that gives all the level-5 and level-7 subjects that   are       offered       at       least       twice       by       the       ‘School’       type       organizations       in         2012.       And       the   organization’s name should   contain ‘Engineering’   .<br>•             subject_code   should be taken from   Subjects.code   field.<br>•          ‘School’ type   refers   to   the   Orgunit_types.name   field   that   contains   ‘   School’.<br>•          The   organization’s   name   refers   to   the   o代 写COMP9311 25T1: Project 1
程序rgunits.longname   field.<br>•          Level-5       refers       to       the       subject_code formatted       as       ‘XXXX5***’,       where      ‘X’   represents   a letter and ‘*’   represents a   number.<br>Question   2   (3 marks)Define   an   SQL   view   Q2(course_id)   that   gives   the   ID   of   the   course   offering   at   least   'Lecture'      and      'Laboratory'      classes.      Only      consider    the       course      that    has       at    least      two   professors   as   staff and   offers   exactly two lectures in two   distinct rooms.<br>•            course_id   refers to the   Courses.id   field.<br>•            Lecture and   Laboratory   refer to the Class_types.name   field.<br>•            Lecture room refers to the   Class.room field   .<br>•            Professor denotes the ‘   Prof’   in   People.title.<br>Question   3   (4 marks)<br>Define a   SQL view   Q3(unsw_id)   that gives the unswid   of   students who   are   enrolled   in   the   'Major',   'Minor', and   'Honours' streams   simultaneously within the same program.<br>The student’s unswid starts   with   326.<br>•            unsw_id   should be taken from people.unswid   field.<br>•          The   stream   types   'Major',   'Minor',   and   'Honours'   are   identified   using   the   refer   to   stream_types.description   field.<br>Question 4   (5 marks)<br>Define   an   SQL view   Q4(course_id,   avg_mark)   that gives   the   course   ID   along with   the   average   mark   of   master’s   students   who   achieved   a   pass   in   each    course.    For    each   faculty and for each year between 2005 and 2015, it includes only those courses that have   the   highest   average   pass   mark   among   all   courses   offered   by   that   Faculty   in   that year.   If   multiple courses have the same maximum average mark in that year,   all   such   courses   are   included.<br>Note:       Round          avg_mark   to       the       nearest          0.01       in          numeric type          (i.e.,          85.014    ≈   85.01, 85.016   ≈   85.02, 85   ≈85.00).<br>•            course_id   should be taken from   Courses.id.<br>•          Faculty   refers   to   the   organization   units   where   their   Orgunit_types.name   is   ‘Faculty’.<br>•          A   student   is   considered   to   have   passed   if their   course   mark    ≥   50.<br>•          The ‘master   students’   refers   to   the   degree_types.name   containing   the   word   ‘Master’.<br>•            The ‘year’   refers to the ‘   semesters   .year’   field.<br>Question   5   (5 marks)<br>Define   a   SQL view   Q5(course_id,   student_names, highest_mark)   that gives   the   ID of course which enrolled more than   500 students   in year   between   2005   and   2015.   Show the highest mark achieved by any student in the course. And the given   names of   the   students   who   achieved   this   highest   mark.   If   multiple   students   share   the   highest   mark,   their given   names   are   concatenated   in   order, separated by   ";   "   (e.g.,   "Jack;       Michele").<br>•            The given   name refers to the   People.given   field.<br>Question   6   (5 marks)Define SQL view Q6(subject_id, year, room_id, usage_count)to return the   ID   of each   subject   that   used   the   largest   number   of distinct   rooms   in    each   year   between   2000   and   2015,   along with   the   room   ID(s) that the   subject used   most frequently   and   the   number   of times the subject used that room. If   there   are   multiple   subjects   or   rooms with   the same maximum usage,   list   all   of   them.<br>•             subject_id   should be taken from   subjects.id field.<br>•            The ‘year’ refers to   the ‘   semesters.year’   field.<br>•             room_id   should be taken from   rooms.id   field.Define SQL view Q7(student_id, orgunit_id, program_id, obtain_days)   that   gives   the   IDs   of   students   who   completed   a   program   in   the   shortest   time   for   each   organization. The completed program is   offered   by   the   organization.   If multiple   students   achieve the same fastest completion time,   all   such   students   are   included.<br>•             student_id   should   be taken from people.unswid   field.<br>•            orgunit_id   refers to   orgunits.id   field.<br>•            program_id   refers to       programs.id   field.<br>•          Assuming   students   can   register   at   most   1   program   in   each   semester.<br>Note:<br>•         A student will pass the course and earn the   UOC   if she/he receives the   mark   ≥   50.<br>•         The   student   is   valid   for   graduation   if the   total   UOC   earned   in   the   program    (hint:   subjects.uoc)    is    no    less    than      the      required      UOC      of    the      program       (refer    to   programs.uoc).<br>•          If a   student   has   enrolled   in   several   different   programs,   you   need   to   calculate   the   UOC   separately   according   to   different   programs. A   course   is   considered   part   of a   program if   the student   enrolls in both the course and the program during the same   semester.<br>•          For   each   student, the duration of one program is the   number   of days   between   the   earliest         date          (hint:          Semesters.starting)          and          the       latest          date          (hint:   Semesters.ending) among all his or her course   enrollments for   that   program,   regardless   of whether the course was passed.<br>Hint:<br>•          In   the   same   program,   a   student   may   register   for   the   same   subject   multiple   times      (multiple   courses)   because   of   possible   retakes   after   failing.   When   determining      program    completion,    only    subjects    with      marks       ≥   50    are      counted,    but   when      calculating   the   duration,   all   enrollment   records   are    included.   We   assume   each      subject   has   only   one   record   with   a   mark   over   50.   If   multiple   courses   share   the      same subject code with a pass, you can treat them as distinct subjects. For example,   some   research   courses   (for   instance,   honours   thesis   A/B/C)   must   be   enrolled   in      multiple times but share the same   subject   code.Define SQL view Q8 (staff_id, student_id, teach_times)   This view   retrieves   the staff ID   (staff_id) of   those who served as a course   convenor   at least three times   in   the years between   2008 and   2012. Additionally, the total ‘above distinction’   rate   (i.e.,   the   percentage   of   students   with   marks   ≥   75)   across   all   courses   in   history   where   the   staff   member as   a course convenor   must   be   ≥   70%.For each such staff   member, the view also returns the student ID   (student_id) of   those   who    enrolled    in    courses    where    the    mentioned    staff    served    but    may    not    as    a    course   convenor, along with the number of   times   (teach_times) the student enrolled in those   courses across their   entire enrollment history.<br>The    result    must      include      only    the      top-2      students      with      the      highest      teach_times       (i.e.,   enrollment count). Additionally, only students with   teach_times   ≥   3   should be   displayed.<br>•          A          person          is       employed          as          a       course          convenor          for       a          course          if       her/his   staff_roles.name   is ‘Course Convenor’   in course_staff.<br>•          ‘Above   distinction’   means that   Course_enrolments.mark   is   ≥   75.<br>•          We   only   consider   the   no-null   mark   in   the ‘Above   distinction’   rate   calculation.<br>•             student_id   should   be taken from people.unswid   field.<br>•             staff_id   should be taken from   People.unswid   field.<br>•          The   Rank()function   in   PostgreSQL   will   be   able   to   do   this   for you to   generate the   ranking   column.Define   a   PL/pgSQL   function   Q9(unswsid   integer)   This   function   takes   a   student's   unswid as input and returns the given name of   the student's favorite teacher—defined   as   the   course   convenor   whose   courses   the   student   has   enrolled   in   the   most   times    (Note:   different with   Q8).Additionally,   the   function   returns:   1)   The   number   of   times   the   student   has   enrolled   in   courses   convened   by   this   teacher.   2)   The   rank   of the   student   based   on   how   many   times   they have enrolled   in the teacher’s courses   compared   to   other   students.<br>•          An   unswid   should be   taken   from   People.unswid   field.<br>•          A          person          is       employed          as          a       course          convenor          for       a          course          if       her/his   staff_roles.name   is ‘Course Convenor’   in   course_staff.<br>•          Only   courses   where   the   student   has   received   a   non-null   mark   are   considered.<br>•          The   teacher’s   given   name   should   be   retrieved   from   ’people.given’.<br>•          The   student's   unswid   should   be   taken   from   ’people.unswid’.<br>•          The   Rank()function   in   PostgreSQL   will   be   able   to   do   this   for you to   generate the   ranking   column.<br>Each      line      of    output       (in       text type)       should      contain      the      following      three       elements   concatenated with   a space:<br>•          Teacher   name:   the   given   name   of the teacher   refer   to   ’people.given’.<br>•          Enrolled   times:   The   number   of times   the   student   enrolled   in   courses   convened   by this   teacher.<br>•          Rank:   the   register   rank   should   be   an   integer.   If she/he   ranked   2nd    in   the   ranking, the result   is   2.<br>Special   output:<br>•          If   the student has not finished any required course with a valid mark, return a line      in   the   format   of   ‘WARNING:   Invalid   Student   Input    [X]’,   where   ‘X’   denotes the provided   unswid.<br>Define a PL/pgSQL function Q10(unswid integer)that takes the unswid ofa student.   Output the students WAM for all the   programs   that   the   student   enrolled.<br>•            An unswid   should be taken from People.unswid   field.<br>•          Unlike   to   the    Question    7,    in   this    question,    a   student   passes   a   course   if   she/he   obtains   a   grade   in   setpass          =    {SY, PT, PC, PS, CR, DN, HD,   A, B,   C, XE, T, PE, RC, RS}   refers to   course_enrolments.grade.<br>•          All    the    grades    in   setpass      ∩ setsy       =   {SY,   XE, T, PE}   or in   setpass    ∩   (course mark   =   null)   ,    means    the    courses    the    student    passed    but    won’t    be    included    in    WAM   calculation.<br>•          All      the      grade       not       in    setpass, excluding the   course mark      =    null,    means       a       fail.   These failed courses are still included in theWAM calculation, while courses with   null marks   are   excluded.<br>•             If a student has   enrolled   in   several   different programs, you need to   calculate   the   WAM   separately according to   different programs. A   course is   considered   part   of   a   program   if the   student   enrolls   in   both   the   course   and   the   program   during   the   same    semester.    Assuming    students      can      register      at      most      1      program      in      each   semester.<br>WAM is   calculated   according to the following formula:<br><br>Where:   M      =      mark received   in   a   course, U   = units of credit for   a   course.<br>•             For example, a student receives   the following   results   for   her/his   courses:   80,   81,   82, 83, 84. The first three   of these   courses   are   6   UOC   and   the   last two   are   3   UOC.      The WAM is calculated as:      = 81.625   ≈ 81.63   .<br>Each line of output   (in   text   type) should   contain the   following   three   elements   concatenated with   a space:<br>•          Unswid:   a   unswid   of student   which   is   taken   from   People.unswid   field.<br>•          Program   name:   a   program   name   which   is   taken   from   programs.name   field.<br>•          WAM:   the   WAM   result   and   round   it   to   the   nearest   0.01.   Use   the   same   rule   as   Q4.   Special   output:<br>•             If the   student   has   enrolled   in   one   program,   but   she/he   did   not   register   for   any   course or all the courses registered   are   not   included   in WAM   calculation   for   that   program,   i.e.,   the   divisor   is   zero,   return   ‘No   WAM   Available’   in   the   WAM   section   of   the return line.<br>•             If the   student   has   not   enrolled   in   any   programs    (cannot   find   any   programs   for   the   student),   return   a   line   in   the   format   of ‘WARNING:   Invalid   Student   Input   [X]’, where ‘X’ denotes the provided   unswid.<br><br><br><br><br><br><br>加QQ：99515681  WX：codinghelp  Email: 99515681@qq.com
